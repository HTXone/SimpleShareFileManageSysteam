<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>成员管理 | 共享云端</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="img/factory1.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/meanmenu.min.css">
    <link rel="stylesheet" href="css/educate-custon-icon.css">
    <!-- metisMenu CSS
    	============================================ -->
    <link rel="stylesheet" href="css/metisMenu/metisMenu.min.css">
    <link rel="stylesheet" href="css/metisMenu/metisMenu-vertical.css">
    <!-- style CSS
    	============================================ -->
    <link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="css/toastr.css" />
	<style>
		table tr#th{
			background-color: #006df0;
			color: white;
		}
		
		.status0{
			background-color: orange;
			color: white;
		}
		
		.status1{
			background-color: #23D5AB;
			color: white;
		}
		
		.status2{
			background-color: gray;
			color: #bfbfbf;
		}
		
		.info{
			color: gray;
		}
		.data{
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
		
		.selectBtn{
			margin-left: 20px;
			margin-top: 2px;
		}
		.selectBtn2{
			padding-left: 3px;
			padding-right: 3px;
			width: 150px;
		}
		.addBtn{
			margin-right: 20px;
			margin-top: 2px;
			float: right;
		}
	</style>
    
	</script>
	<style type="text/css">
		.a{
			margin-top: 70px;
		}
		.disabled {
		            pointer-events: none;
		            filter: alpha(opacity=50);
		            -moz-opacity: 0.5; 
		            opacity: 0.5; 
					}
	</style>
</head>

<body>
    <!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->
    <!-- Start Left menu area -->
    <div class="left-sidebar-pro">
        <nav id="sidebar" class="">
            <div class="sidebar-header">
                <a href="mainpage.html"><img class="main-logo" src="img/logo/LOGO1.png" alt="" /></a>
                <strong><a href="mainpage.html"><img src="img/logo/factory6.png" alt="" /></a></strong>
            </div>
            <div class="left-custom-menu-adp-wrap comment-scrollbar">
                <nav class="sidebar-nav left-sidebar-menu-pro">
                    <ul class="metismenu" id="menu1">
                        <li class="checked">
                            <a  href="index_.html" >
								   <span class="educate-icon educate-home icon-wrap"></span>
								   <span class="mini-click-non">文件管理</span>
								</a>
                        </li>
                      <li>
                          <a href="History.html" aria-expanded="false"><span class="educate-icon educate-search icon-wrap"></span> <span class="mini-click-non">历史记录</span></a>
                          
                      </li>
                      <li>
                          <a href="users.html" aria-expanded="false"><span class="educate-icon educate-professor icon-wrap"></span> <span class="mini-click-non">用户管理</span></a>
                      
                      </li>
                        
                    </ul>
                </nav>
            </div>
        </nav>
    </div>
    <div class="all-content-wrapper">
        
        <div class="header-advance-area">
            <div class="header-top-area">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="header-top-wraper">
                                <div class="header-top-wraper">
                                    <div class="row">
                                        <div class="col-lg-1 col-md-0 col-sm-1 col-xs-12">
                                            <div class="menu-switcher-pro">
                                                <button type="button" id="sidebarCollapse" class="btn bar-button-pro header-drl-controller-btn btn-info navbar-btn">
                                						<i class="educate-icon educate-nav"></i>
                                					</button>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-7 col-sm-6 col-xs-12">
                                            <div class="header-top-menu tabl-d-n">
                                                
                                            </div>
                                        </div>
                                        <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                                            <div class="header-right-info">
                                                <ul class="nav navbar-nav mai-top-nav header-right-menu">
                                                    
                                                    <li class="nav-item" id="uname">
                                                        <a :href="link" @click="isLogin" class="info"data-toggle="modal" data-target="#logout">{{username}}</a>
                                                        
                                                    </li>
                                                    
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mobile Menu start -->
            <div class="mobile-menu-area">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="mobile-menu">
                                <nav id="dropdown">
                                    <ul class="mobile-menu-nav">
                                        <li>
                                            <a v-if="ta" href="index_.html" aria-expanded="false"><span class="educate-icon educate-search icon-wrap"></span> <span class="mini-click-non">文件管理</span></a>
                                            
                                        </li>
                                        <li>
                                            <a v-if="fa" href="History.html" aria-expanded="false"><span class="educate-icon educate-professor icon-wrap"></span> <span class="mini-click-non">历史记录</span></a>
                                            
                                        </li>
                                        
                                        <li>
                                            <a v-if="fa" href="users.html" aria-expanded="false"><span class="educate-icon educate-professor icon-wrap"></span> <span class="mini-click-non">用户管理</span></a>
                                            
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mobile Menu end -->
            <div class="breadcome-area">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="analytics-sparkle-area a">
            <div class="analytics-sparkle-area a">
                <div class="container-fluid well">
                    <div class="form-group" id="selectList">
                    	<form class="form-inline" onsubmit="return false">
                    		<label form="name" style="margin-left: 20px; margin-right: 5px;">成员姓名</label>
                    		<input class="form-control" type="text" v-model="userName" placeholder=""/>
                    		
                    		<button class="btn selectBtn" @click="doSelect">查询</button>
							<button class="btn selectBtn" @click="findAll">查询所有</button>
                    		
							<button v-if="isOwner" type="button" class="btn addBtn" data-toggle="modal" data-target="#myModal" @click="getIndex(-1)"><a href="#" class="" >Add</a></button>
                    	</form>
                    </div>
                </div>
            </div>
        </div>
        <div class="product-sales-area mg-tb-30">
            <div class="data" style="width: 1200px;margin:0 auto;">
            	<table class="table table-striped table-hover" id="tableapp" >
            		<tr id="th">
            	    <th>序号</th>
            		<th>用户号</th>
            		<th>用户名</th>
            		<th>操作</th>
            		</tr>
            		
            		<tr v-for="(tr,index) in displayData">
            		<td>{{index+1}}</td>
            		<td>{{tr.userId}}</td>
            		<td>{{tr.name}}</td>
            		<td>
						<a v-if="isOwner" href="#" class="info" data-toggle="modal" data-target="#myModal" @click="getIndex(index)">编辑</a>
						<a v-if="isOwner" href="javascript:void(0);" data-toggle="modal" data-target="#delete" @click="getDid(tr.userId);" class="info">删除</a>
					</td>
            		
            		</tr>
            		
            		</table>
					<!-- <div style="text-align: center;" id="page">
						<ul class="pagination" >
							<li >
								<a href="javascript:void(0)" @click="flushPage(1)">首页</a>
								<a v-for="index in pageNum" href="javascript:void(0);" @click="flushPage(index)">{{index}}</a>
								<a href="javascript:void(0);" @click="flushPage(pageNum)">尾页</a>
							</li>
							
						</ul>
					</div> -->
					
            </div>
        </div>
        </div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" 
		aria-hidden="true" data-keyboard="false"data-backdrop="false">
		            <div class="modal-dialog" id="updateList">
		                <div class="modal-content">
		                    <div class="modal-header b">
		                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
		                    &times;
		                </button>
		                        <h4 class="modal-title" id="myModalLabel">
		                    新建/编辑
		                </h4>
		                    </div>
		                    <div class="modal-body form-group">
		                        <label for="cc-exp" class="control-label mb-1">UserName:</label>&emsp;
								<input type="text" name="cc-exp" id="cc-exp" v-model="userName" />
								<br><br>
								<label class="control-label mb-1">password:</label>
								<input type="text" name="cc-exp" id="cc-exp" v-model="PWD"/>
		                    </div>
		                    <div class="modal-footer">
		                        <button type="button" class="btn btn-primary" onclick="updateVue.doUpdate()" data-dismiss="modal">
		                    提交更改
		                </button>
		                    </div>
		                </div>
		                <!-- /.modal-content -->
		            </div>
		            <!-- /.modal -->
		        </div>
	<div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
				aria-hidden="true" data-keyboard="false"data-backdrop="false">
				            <div class="modal-dialog" id="updateList">
				                <div class="modal-content">
				                    <div class="modal-header b">
				                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
				                    &times;
				                </button>
				                        <h4 class="modal-title" id="myModalLabel">
				                    删除
				                </h4>
				                    </div>
				                    <div class="modal-body form-group">
										您确定要删除此成员吗?
				                    </div>
				                    <div class="modal-footer">
				                        <button type="button" class="btn btn-primary" onclick="vm.deleteu(vm.Did)" data-dismiss="modal">
				                    确定
				                </button>
								<button type="button" class="btn btn-default"  data-dismiss="modal">
								    取消
								</button>
				                    </div>
				                </div>
				                <!-- /.modal-content -->
				            </div>
				            <!-- /.modal -->
				        </div>
	<div class="modal fade" id="logout" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
					aria-hidden="true" data-keyboard="false"data-backdrop="false">
					            <div class="modal-dialog" id="updateList">
					                <div class="modal-content">
					                    <div class="modal-header b">
					                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                    &times;
					                </button>
					                        <h4 class="modal-title" id="myModalLabel">
					                    登出
					                </h4>
					                    </div>
					                    <div class="modal-body form-group">
											您确定要退出登录?
					                    </div>
					                    <div class="modal-footer">
					                        <button type="button" class="btn btn-primary" onclick="vm.logout()" data-dismiss="modal">
					                    确定
					                </button>
									<button type="button" class="btn btn-default"  data-dismiss="modal">
									    取消
									</button>
					                    </div>
					                </div>
					                <!-- /.modal-content -->
					            </div>
					            <!-- /.modal -->
					        </div>
	<!--	
    <!-- jquery
		============================================ -->
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="js/jquery-price-slider.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="js/jquery.meanmenu.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- sticky JS
		============================================ -->
    <script src="js/jquery.sticky.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="js/counterup/jquery.counterup.min.js"></script>
    <script src="js/counterup/waypoints.min.js"></script>
    <script src="js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/scrollbar/mCustomScrollbar-active.js"></script>
    <!-- metisMenu JS
		============================================ -->
    <script src="js/metisMenu/metisMenu.min.js"></script>
    <script src="js/metisMenu/metisMenu-active.js"></script>
    <!-- morrisjs JS
		============================================ -->
    
    <!-- morrisjs JS
		============================================ -->
    <script src="js/sparkline/jquery.sparkline.min.js"></script>
    <script src="js/sparkline/jquery.charts-sparkline.js"></script>
    <script src="js/sparkline/sparkline-active.js"></script>
    <!-- calendar JS
		============================================ -->
    <script src="js/calendar/moment.min.js"></script>
    <script src="js/calendar/fullcalendar.min.js"></script>
    <script src="js/calendar/fullcalendar-active.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="js/plugins.js"></script>
    <!-- main JS
		============================================ -->
    <script src="js/main.js"></script>
	

</body>
</html>
<script src="js/axios.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/toastr.min.js"></script>
<script type="text/javascript">
			toastr.options.positionClass = 'toast-right-top';
</script>
<script>
	var vm = new Vue({
	    el:"#tableapp",
	    data:{
	        // scolor:["status0","status1","status2","status3","status4"],
	        // sname:["已拒绝","未接单","已接单","生产中","已完成"],
	        displayData:null,
			Did : 0,
			isOwner : false,
	    },
	    mounted(){
	        axios
	            .post("user/user.do")	
	            .then(response => (this.displayData = response.data.data))
	            .catch(function (error) {
	                console.log(error);
	            });
	    },
	    methods:{
			deleteu(uid){
				axios.post('user/delete.do?uid='+this.Did)
				.then(response => (vm.displayData = response.data.data))
				.catch(function(error){
					console.log(error)
				})
			},
			getIndex(Index){
				if(Index<0){
						updateVue.userName =  "";
						updateVue.Uid = "";
						updateVue.PWD = "";
						return;
					}
					Udata = vm.displayData[Index];
					updateVue.userName = Udata.name;
					updateVue.Uid = Udata.userId;
					updateVue.PWD = "";
			},
			getDid(id){
				this.Did = id;
			}	
			
			
	    }
	});
	
	var selectVue = new Vue({
		el : '#selectList',
		data : {
			userName : "",
			isOwner : false
		},
		methods:{
			doSelect : function(){
				axios.post('user/select.do?UserName='+this.userName)
				.then(response => {
					if(!response.data.result){
						toastr.error("查询错误")
					}else{
						vm.displayData = response.data.data;
					}
				})
				.catch(function(error){
					console.log(error)
				})
			},
			getIndex(Index){
				console.log(Index)
				updateVue.Uid = "";
				updateVue.userName =  "";
				updateVue.PWD = "";
				return;
			},
			findAll : function(){
				axios
				    .post("user/user.do")	
				    .then(response => {
					if(!response.data.result){
						toastr.error("查询错误")
					}else{
						vm.displayData = response.data.data;
					}
				})
				    .catch(function (error) {
				        console.log(error);
				    });
				page.initPage("",1);
			}
			
		},
		
	});
	
	var updateVue = new Vue({
		el : '#updateList',
		data : {
			Uid : "",
			userName : "",
			PWD : "",
			root : "",
		},
		methods:{
			doAdd : function(){
				axios.post('user/addUser.do?username='+this.userName+'&PWD='+this.PWD)
				.then(response => {
					if(!response.data.result){
						toastr.error("新增错误")
					}else{
						vm.displayData = response.data.data;
						toastr.success("成功")
					}
				})
				.catch(function(error){
					console.log(error)
				})
				page.initPage("donotchangename",0);
			},
				
			doUpdate : function(){
				if(this.Uid == ""){
					this.doAdd();
					return;
				}
				else{
					axios.post('user/update.do?userName='+this.userName+'&PWD='+this.PWD+'&uid='+this.Uid)
					.then(response => {
					if(!response.data.result){
						toastr.error("更新错误")
					}else{
						vm.displayData = response.data.data;
						toastr.success("成功")
					}
				})
					.catch(function(error){
						console.log(error)
				})
				}
			},
			
			doDelete : function(){
				axios.post('user/delete.do?uid='+this.Uid)
				.then(response => (vm.displayData = response.data.data))
				.catch(function(error){
					console.log(error)
				})
			},
			getName : function(name){
				this.userName = name;
			},
			getUid : function(id){
				this.Uid = id;
			},
			getPWD : function(PWD){
				this.PWD = PWD
			},
			RootCmp : function(root){
				for(i=0;i<this.root.length;i++){
					if(!(root[i]>=0&&root[i]<=1)){
						toastr.error("请输入二进制字符");
						return false;
					}
				}
				return true;
			}
		}
			
		
	});
	
	var uname = new Vue({
		el:"#uname",
		data:{
			username:"未登录，请先登录",
			link:"/",
			isOwner: ""
		},
		mounted(){
		    axios
		        .get("user/whoami.do")	
		        .then(response => {
					if(response.data.username=="未登录"){
						this.username="未登录，请先登录";
						this.link="index_.html";
					}else{
						this.username="欢迎，"+response.data.username;
						this.isOwner = response.data.isOwner;
						if(this.isOwner == "true"){
							vm.isOwner = true;
							selectVue.isOwner = true;
						}
					}
				
				})
		        .catch(function (error) {
		            console.log(error);
		        });
		},
		methods:{
			isLogin : function(){
				if(this.username == "未登录，请先登录"){
					window.location.href="."
				}
			}
		}
	})
	
	var page = new Vue({
		el:"#page",
		data:{
			pageNum:1,
			which:true,
			username:""
		},
		mounted(){
			this.initPage("",1);
		},
		methods:{
			flushPage(index){//建议在init后执行
				document.cookie = "index="+index;
				if(this.which){
					axios
					    .get("/user/user.do")	
					    .then(response => (vm.displayData = response.data.data))
					    .catch(function (error) {
					        console.log(error);
					    });
				}
				else{
					
					axios
					    .get("/user/sname.do",{
							params:{
								username:this.username
							}
						})	
					    .then(response => (vm.displayData = response.data.data))
					    .catch(function (error) {
					        console.log(error);
					    });
				}
				
					
			},
			initPage(uname,index){//一般情况下index都传1,0表示保持index不变
				if(uname=="donotchangename"){
					
				}
				else if(uname==""){//切换到非查询模式
					axios
					    .get("/user/pagenum.do",{
							params:{
							}
						})
					    .then(response=>{
							this.pageNum=response.data.num;
						})
					    .catch(function (error) {
					        console.log(error);
					    });
					this.which=true;
				}
				else{//切换到查询模式
					axios
					    .get("/user/pagenum.do",{
							params:{
								username:uname
							}
						})
					    .then(response=>{
							this.pageNum=response.data.num;
						})
					    .catch(function (error) {
					        console.log(error);
					    });
					this.which=false;
					this.username=uname;
				}
				if(index!=0){
					document.cookie = "index="+index;
				}

				
			}
		}
	});
	
	
	
	
	var auth = new Vue({
		el:"#menu1",
		data:{
			fa:false,
			oa:false,
			pla:false,
			wa:false,
			ta:false
		},
		mounted() {
			console.log(document.cookie);
			this.fa=this.getCookie("fa");
			this.oa=this.getCookie("oa");
			this.pla=this.getCookie("pla");
			this.wa=this.getCookie("wa");
			this.ta=this.getCookie("ta");
		},
		methods:{
			getCookie(cname)
			{
			  var name = cname + "=";
			  for(var i=0; i<ca.length; i++) 
			  {
			    var c = ca[i].trim();
			    if (c.indexOf(name)==0) return true;
			  }
			  return false;
			}
			
	
		}
	})
	
</script>